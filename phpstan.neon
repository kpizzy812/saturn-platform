includes:
    - vendor/larastan/larastan/extension.neon

parameters:
    level: 5
    paths:
        - app
    tmpDir: .phpstan-cache
    reportUnmatchedIgnoredErrors: false

    # PHPDoc-sourced type checks: when PHPStan derives always-true/false conclusions
    # from our @property annotations, treat them as informational, not errors.
    # Enabling this prevents false positives caused by nullable @property types that
    # are guaranteed non-null by Eloquent at the point of use.
    treatPhpDocTypesAsCertain: false

    ignoreErrors:
        # Legacy Blade view components reference views removed during React/Inertia migration.
        # The view-string type is a Larastan-specific check; these components are dead code
        # awaiting removal but harmless at runtime.
        -
            identifier: argument.type
            message: '#expects view-string\|null, string given#'
            paths:
                - app/View/Components/
                - app/Http/Controllers/Controller.php

        # Eloquent magic properties: PHPStan cannot detect properties defined via
        # database columns or dynamic $fillable arrays. These are all valid at runtime.
        # Tracked in @property blocks on each model; the few remaining gaps are
        # in vendor models (Laravel\Sanctum\PersonalAccessToken) or traits used
        # across multiple contexts. Not a runtime risk.
        -
            identifier: property.notFound

        # ApiAbility::handle() intentionally widens return type to Symfony\Response (common base)
        # to support both Illuminate\Http\Response and JsonResponse returned by $next().
        # This is safe at runtime — PHP only validates the actual returned value type.
        -
            identifier: return.type
            message: '#ApiAbility::handle\(\) should return Illuminate\\Http\\Response#'
            paths:
                - app/Http/Middleware/ApiAbility.php

        # Collection::map() and Paginator::through() closure types cannot be resolved
        # when the callback uses Inertia/array transforms. Larastan limitation — no runtime risk.
        -
            identifier: argument.unresolvableType
