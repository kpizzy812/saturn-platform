# =============================================================================
# Saturn Platform - Monitoring Stack (Gatus)
# =============================================================================
# Config-driven uptime monitoring. No UI setup needed.
# Starts automatically on production deploy via CI/CD.
#
# Config: deploy/gatus/config.yaml (copied to VPS by deploy workflow)
# Status page: https://status.saturn.ac
#
# Manual start (if needed):
#   docker compose -f docker-compose.monitoring.yml up -d
# =============================================================================

services:
  gatus:
    image: twinproduction/gatus:latest
    container_name: saturn-gatus
    restart: always
    volumes:
      - /data/saturn/shared/gatus/config.yaml:/config/config.yaml:ro
      - saturn-gatus-data:/data
    environment:
      # Telegram alerts — set as GitHub Secrets (MONITORING_TELEGRAM_TOKEN, MONITORING_TELEGRAM_CHAT_ID)
      MONITORING_TELEGRAM_TOKEN: "${MONITORING_TELEGRAM_TOKEN:-}"
      MONITORING_TELEGRAM_CHAT_ID: "${MONITORING_TELEGRAM_CHAT_ID:-}"
    expose:
      - "8080"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      retries: 5
      timeout: 10s
    networks:
      # Shared proxy network: Traefik routes status.saturn.ac → this container
      saturn:
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.25'

volumes:
  saturn-gatus-data:
    name: saturn-gatus-data

networks:
  saturn:
    name: saturn
    external: true
