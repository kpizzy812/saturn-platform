# Saturn Platform - Deployment Scripts

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Saturn Platform –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ.

## –°–∫—Ä–∏–ø—Ç—ã

### üéõÔ∏è saturn-ctl.sh - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ì–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Saturn Platform —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é.

#### –ó–∞–ø—É—Å–∫

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
./saturn-ctl.sh

# –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã
./saturn-ctl.sh logs      # –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ª–æ–≥–æ–≤
./saturn-ctl.sh deploy    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π
./saturn-ctl.sh status    # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
./saturn-ctl.sh restart   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**1. Deploy & Restart**
- ‚úÖ –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (pull + migrate + restart)
- üöÄ –ë—ã—Å—Ç—Ä—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç (–±–µ–∑ pull –∏ –º–∏–≥—Ä–∞—Ü–∏–π)
- üîÑ –†–µ—Å—Ç–∞—Ä—Ç —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚èÆÔ∏è –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –±—ç–∫–∞–ø—É

**2. View Logs**
- üìã –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (realtime)
- üéØ –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å—Ç—Ä–æ–∫ + follow
- üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å—Ç—Ä–æ–∫ (—Å—Ç–∞—Ç–∏—á–Ω–æ)
- üîç –ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö

**3. Service Control**
- ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- üéØ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

**4. Build & Cache**
- üì• Pull –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±—Ä–∞–∑–æ–≤
- üèóÔ∏è –ë–∏–ª–¥ —Å –∫—ç—à–µ–º
- üÜï –ë–∏–ª–¥ –±–µ–∑ –∫—ç—à–∞ (fresh)
- üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ Laravel –∫—ç—à–µ–π
- üîÑ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Laravel –∫—ç—à–µ–π
- ‚ôªÔ∏è –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

**5. Database Operations**
- üì§ –ú–∏–≥—Ä–∞—Ü–∏–∏
- üÜï Fresh –º–∏–≥—Ä–∞—Ü–∏–∏ (DROP ALL!)
- üå± –°–∏–¥–µ—Ä—ã
- üíæ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
- üìã –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
- üì• –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
- üêò PostgreSQL shell (psql)

**6. System Information**
- üê≥ –í–µ—Ä—Å–∏–∏ Docker
- üíΩ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
- üìä –†–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (CPU, RAM, Network)
- üì¶ –í–µ—Ä—Å–∏—è Laravel

---

### üöÄ deploy.sh - –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π Saturn Platform.

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
./deploy.sh

# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –±—ç–∫–∞–ø—É
./deploy.sh --rollback
```

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

1. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è prerequisites (Docker, .env —Ñ–∞–π–ª)
2. üíæ –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. üì• Pull Docker –æ–±—Ä–∞–∑–æ–≤
4. ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
5. ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
6. üì§ –ú–∏–≥—Ä–∞—Ü–∏–∏
7. üå± –°–∏–¥–µ—Ä—ã
8. ‚ôªÔ∏è –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫—ç—à–µ–π
9. üè• Health check

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export SATURN_IMAGE_TAG=main          # –¢–µ–≥ Docker –æ–±—Ä–∞–∑–∞
export REGISTRY_URL=ghcr.io           # Docker registry
```

---

### üõ†Ô∏è setup-server.sh - –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/data/saturn/
‚îú‚îÄ‚îÄ source/
‚îÇ   ‚îî‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ ssh/                        # SSH –∫–ª—é—á–∏
‚îú‚îÄ‚îÄ applications/               # –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ databases/                  # –î–∞–Ω–Ω—ã–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ services/                   # –î–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ backups/                    # –ë—ç–∫–∞–ø—ã –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ pre_deploy_*.sql       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (–ø—Ä–∏ –¥–µ–ø–ª–æ–µ)
‚îÇ   ‚îî‚îÄ‚îÄ manual_*.sql           # –†—É—á–Ω—ã–µ –±—ç–∫–∞–ø—ã
‚îî‚îÄ‚îÄ uploads/                    # –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã (–∞–≤–∞—Ç–∞—Ä—ã, –ª–æ–≥–æ—Ç–∏–ø—ã)
```

## –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

- **saturn-dev** - Laravel –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Ä—Ç 8000)
- **saturn-db** - PostgreSQL 15
- **saturn-redis** - Redis 7
- **saturn-soketi** - WebSocket —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç—ã 6001, 6002)

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º

```bash
# Laravel shell
docker exec -it saturn-dev sh

# Laravel Artisan
docker exec saturn-dev php artisan tinker

# PostgreSQL shell
docker exec -it saturn-db psql -U saturn -d saturn

# Redis CLI
docker exec -it saturn-redis redis-cli -a YOUR_PASSWORD

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs -f saturn-dev
docker logs -f --tail=1000 saturn-dev
```

### Docker Compose –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å
docker compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.dev.override.yml --env-file /data/saturn/source/.env ps

# –õ–æ–≥–∏
docker compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.dev.override.yml --env-file /data/saturn/source/.env logs -f

# –†–µ—Å—Ç–∞—Ä—Ç
docker compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.dev.override.yml --env-file /data/saturn/source/.env restart
```

## Troubleshooting

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
./saturn-ctl.sh
# –í—ã–±—Ä–∞—Ç—å: 2 (Logs) -> 2 (Select Container) -> 1 (Saturn Application)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
./saturn-ctl.sh status

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
./saturn-ctl.sh restart
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
docker exec saturn-db pg_isready -U saturn

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
docker exec saturn-db psql -U saturn -d saturn -c "SELECT * FROM pg_stat_activity;"

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
./saturn-ctl.sh
# –í—ã–±—Ä–∞—Ç—å: 5 (Database) -> 4 (Create Backup)
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∏—Å–∫–∞

```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker system prune -a

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)
cd /data/saturn/backups
ls -t *.sql | tail -n +11 | xargs rm
```

## –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–∏–∞—Å–∞

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

```bash
# Saturn Platform Control
alias saturn='cd /root/coolify-Saturn/deploy/scripts && ./saturn-ctl.sh'
alias saturn-logs='cd /root/coolify-Saturn/deploy/scripts && ./saturn-ctl.sh logs'
alias saturn-deploy='cd /root/coolify-Saturn/deploy/scripts && ./deploy.sh'
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```bash
saturn           # –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
saturn-logs      # –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ª–æ–≥–æ–≤
saturn-deploy    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**

1. –§–∞–π–ª `/data/saturn/source/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏ –ë–î, –∫–ª—é—á–∏)
2. –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –ë–î
3. –ù–µ —É–¥–∞–ª—è–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã `pre_deploy_*.sql` - –æ–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞
4. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `migrate:fresh` –í–°–ï –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

```bash
curl http://localhost:8000/api/health
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker stats
```

### –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.dev.override.yml --env-file /data/saturn/source/.env logs -f

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ Laravel
docker logs -f saturn-dev 2>&1 | grep -i error
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. –°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ)
# 2. Pull –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏ –¥–µ–ø–ª–æ–π
./saturn-ctl.sh
# –í—ã–±—Ä–∞—Ç—å: 1 (Deploy) -> 1 (Full Deploy)

# –ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É
./deploy.sh
```

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –û—Ç–∫–∞—Ç –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –±—ç–∫–∞–ø—É
./deploy.sh --rollback

# –ò–ª–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é
./saturn-ctl.sh
# –í—ã–±—Ä–∞—Ç—å: 1 (Deploy) -> 4 (Rollback)
```

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [CLAUDE.md](../../CLAUDE.md)
**–ü—Ä–æ–µ–∫—Ç:** Saturn Platform - Self-hosted PaaS
